# -*- coding: utf-8 -*-
"""
Created on Mon Feb  2 19:49:45 2026

@author: ambade
"""

"""
Created by DHiR
@author: DHIR
"""

import tkinter as tk
from tkinter import messagebox, ttk
import csv, os

BG,CARD,FG,BTN,BTN2,INP="#121212","#1e1e1e","#e5e7eb","#2563eb","#374151","#2a2a2a"

EMP="employees.csv"
REC="recruiters.csv"
JOBS="jobs.csv"

SKILLS=[
    "Python","Java","C++","JavaScript","HTML","CSS","SQL",
    "Data Structures","Algorithms","OOP","Machine Learning",
    "Data Analysis","AI","Django","Flask","React","Node.js",
    "Git","Linux","AWS","Cyber Security","Networking"
]

HDR={
    "employee":["username","password","name","mobile","email","gender","age","address","skills"],
    "recruiter":["username","password","company","contact","email","address","industry","company_size","skills"]
}

JOB_HDR=["username","job_name","salary","education","experience","skills"]

session={}

def ensure(p,h):
    if not os.path.exists(p):
        with open(p,"w",newline="") as f:
            csv.writer(f).writerow(h)

def read(p):
    if not os.path.exists(p): return []
    with open(p,newline="") as f:
        return list(csv.DictReader(f))

def write(p,h,r):
    with open(p,"w",newline="") as f:
        w=csv.DictWriter(f,fieldnames=h)
        w.writeheader()
        w.writerows(r)

def find(u):
    for role,p in [("employee",EMP),("recruiter",REC)]:
        for r in read(p):
            if r["username"]==u:
                return role,r
    return None,None

root=tk.Tk()
root.title("Jobsphere")
root.configure(bg=BG)

style=ttk.Style()
style.theme_use("default")
style.configure("Dark.TCombobox",fieldbackground=INP,background=INP,foreground=FG)

def clear():
    for w in root.winfo_children():
        w.destroy()

def title(t):
    tk.Label(root,text=t,font=("Arial",18,"bold"),bg=BG,fg=FG).pack(pady=10)

def box():
    f=tk.Frame(root,bg=CARD,padx=18,pady=15)
    f.pack(pady=10)
    return f

def entry(p,hide=False):
    e=tk.Entry(p,bg=INP,fg=FG,insertbackground=FG,show="*" if hide else "")
    e.pack(fill="x",pady=3)
    return e

def dropdown(p,v):
    c=ttk.Combobox(p,values=v,state="readonly",style="Dark.TCombobox")
    c.pack(fill="x",pady=3)
    return c

def button(t,c,pri=True):
    tk.Button(root,text=t,command=c,width=22,bg=BTN if pri else BTN2,
              fg="white",relief="flat").pack(pady=4)

def start():
    clear()
    title("Jobsphere")
    button("Register",role_select)
    button("Login",login)
    button("Quit",root.destroy,False)

def role_select():
    clear()
    title("Select Role")
    f=box()
    role=tk.StringVar(value="employee")

    for r in ("employee","recruiter"):
        tk.Radiobutton(f,text=r.capitalize(),variable=role,value=r,
                       bg=CARD,fg=FG,selectcolor=CARD).pack(anchor="w")

    button("Next",lambda:(session.update(role=role.get()),details()))
    button("Back",start,False)

def details():
    clear()
    title("Details")
    f=box()
    role=session["role"]
    inp={}

    for k in HDR[role][2:-1]:
        tk.Label(f,text=k.replace("_"," ").title(),bg=CARD,fg=FG).pack(anchor="w")
        inp[k]=dropdown(f,["Male","Female","Other"]) if k=="gender" else entry(f)

    def save():
        for v in inp.values():
            if not v.get():
                return messagebox.showerror("Error","All fields required")
        session["details"]={k:inp[k].get() for k in inp}
        skills()

    button("Next",save)
    button("Back",start,False)

def skills():
    clear()
    title("Select Skills")
    f=box()
    sel=[(s,tk.IntVar()) for s in SKILLS]

    for s,v in sel:
        tk.Checkbutton(f,text=s,variable=v,bg=CARD,fg=FG,
                       selectcolor=CARD).pack(anchor="w")

    def save():
        chosen=[s for s,v in sel if v.get()]
        if not chosen:
            return messagebox.showerror("Error","Select at least one skill")
        session["skills"]=";".join(chosen)
        creds()

    button("Next",save)
    button("Back",start,False)

def creds():
    clear()
    title("Create Account")
    f=box()

    tk.Label(f,text="Username",bg=CARD,fg=FG).pack(anchor="w")
    u=entry(f)
    tk.Label(f,text="Password",bg=CARD,fg=FG).pack(anchor="w")
    p=entry(f,True)

    def save():
        if find(u.get())[0]:
            return messagebox.showerror("Error","Username exists")

        row={"username":u.get(),"password":p.get(),"skills":session["skills"]}
        row.update(session["details"])

        path=EMP if session["role"]=="employee" else REC
        data=read(path)
        data.append(row)
        write(path,HDR[session["role"]],data)
        session.clear()
        start()

    button("Finish",save)
    button("Back",start,False)

def login():
    clear()
    title("Login")
    f=box()

    tk.Label(f,text="Username",bg=CARD,fg=FG).pack(anchor="w")
    u=entry(f)
    tk.Label(f,text="Password",bg=CARD,fg=FG).pack(anchor="w")
    p=entry(f,True)

    def do():
        role,user=find(u.get())
        if not user or user["password"]!=p.get():
            return messagebox.showerror("Error","Invalid login")
        session.update(username=u.get(),role=role)
        match()

    button("Login",do)
    button("Back",start,False)

def add_job():
    clear()
    title("Add Job Vacancy")
    f=box()

    fields={}
    for t in ["Job Name","Starting Salary","Education Required","Experience (Years / None)"]:
        tk.Label(f,text=t,bg=CARD,fg=FG).pack(anchor="w")
        fields[t]=entry(f)

    def save():
        if not all(v.get() for v in fields.values()):
            return messagebox.showerror("Error","All fields required")

        _,u=find(session["username"])
        row={
            "username":session["username"],
            "job_name":fields["Job Name"].get(),
            "salary":fields["Starting Salary"].get(),
            "education":fields["Education Required"].get(),
            "experience":fields["Experience (Years / None)"].get(),
            "skills":u["skills"]
        }

        data=read(JOBS)
        data.append(row)
        write(JOBS,JOB_HDR,data)
        match()

    button("Save Job",save)
    button("Back",match,False)

def show_more(username):
    clear()
    title("Recruiter Info")
    f=box()

    _,r=find(username)
    for k in ["company","industry","company_size","email","contact"]:
        tk.Label(f,text=f"{k.title()}: {r.get(k,'')}",bg=CARD,fg=FG).pack(anchor="w")

    title("Job Vacancies")
    for j in read(JOBS):
        if j["username"]==username:
            b=box()
            for k in ["job_name","salary","education","experience"]:
                tk.Label(b,text=f"{k.replace('_',' ').title()}: {j[k]}",
                         bg=CARD,fg=FG).pack(anchor="w")

    button("Back",match,False)

def match():
    clear()
    title("Matches")

    frame=tk.Frame(root,bg=BG)
    frame.pack(pady=10)

    scroll=tk.Scrollbar(frame)
    scroll.pack(side="right",fill="y")

    out=tk.Text(frame,width=70,height=18,bg=INP,fg=FG,
                yscrollcommand=scroll.set,relief="flat")
    out.pack(side="left")
    scroll.config(command=out.yview)

    _,u=find(session["username"])
    us=set(u["skills"].split(";"))
    others=read(REC if session["role"]=="employee" else EMP)

    for o in others:
        common=us & set(o["skills"].split(";"))
        if common:
            out.insert("end",
                f"Name: {o.get('company',o.get('name'))}\n"
                f"Email: {o['email']}\n"
                f"Matched Skills: {', '.join(common)}\n")

            if session["role"]=="employee":
                btn=tk.Button(out,text="More Info",
                              command=lambda u=o["username"]:show_more(u),
                              bg=BTN,fg="white")
                out.window_create("end",window=btn)

            out.insert("end","\n"+"-"*40+"\n")

    out.config(state="disabled")

    if session["role"]=="recruiter":
        button("Add Job Vacancy",add_job)

    button("Home",start,False)

ensure(EMP,HDR["employee"])
ensure(REC,HDR["recruiter"])
ensure(JOBS,JOB_HDR)

start()
root.mainloop()
